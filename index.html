<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer</title>

    <style>
        @font-face {
        font-family: 'MC-font';
        src: url('MinecraftRegular-Bmg3.otf') format('truetype');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
        }
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: transparent;
            overflow: hidden;
        }
        .Timer, .Deaths{
            color: white;
            -webkit-text-stroke: 3px black;
            font-size: 90px;
            letter-spacing: 5px;
            font-family: 'MC-font', serif;
        }
    </style>
</head>
<body>
    <div class="Deaths">Smierci: 0</div>
    <div class="Timer">Time: 00:00</div>
    <script>
    // Zmienne deklarujemy TYLKO RAZ
    let Time = localStorage.getItem("timer_time") ? parseInt(localStorage.getItem("timer_time")) : 0;
    let Deaths = localStorage.getItem("Deaths_count") ? parseInt(localStorage.getItem("Deaths_count")) : 0;
    let isRunning = false;
    const display_deaths = document.querySelector(".Deaths");
    const display_time = document.querySelector(".Timer");

    // Pierwsze odświeżenie widoku
    updateDisplay();

    function updateDisplay() {
        let h = Math.floor(Time / 3600);
        let m = Math.floor((Time % 3600) / 60);
        let s = Math.floor(Time % 60);
        
        let hDisplay = h > 0 ? (h < 10 ? '0' + h : h) + ":" : "";
        let mDisplay = (m < 10 ? '0' + m : m) + ":";
        let sDisplay = s < 10 ? '0' + s : s;

        display_deaths.textContent = "Smierci: " + Deaths;
        display_time.textContent = "Time: " + hDisplay + mDisplay + sDisplay;

        localStorage.setItem("Deaths_count", Deaths);
        localStorage.setItem("timer_time", Time);
    }

    function TimeUp() {
        if (isRunning) {
            Time++;
            updateDisplay();
        }
    }

    function connectTwitch() {
        if (typeof ComfyJS !== "undefined") {
            ComfyJS.onCommand = (user, command, message, flags) => {
                if (flags.broadcaster || flags.mod) {
                    if (command === "t+") { Deaths++; updateDisplay(); }
                    if (command === "t-") { Deaths--; updateDisplay(); }
                    
                    if (command === "tstart") isRunning = true;
                    if (command === "tstop") isRunning = false;
                    if (command === "treset") { Time = 0; updateDisplay(); }

                    if (command === "tsetdeaths" || command === "t++") {
                        let howMany = parseInt(message);
                        if (!isNaN(howMany)) {
                            Deaths = howMany;
                            updateDisplay();
                        }
                    }

                    if (command === "tset") {
                        let totalSeconds = 0;
                        if (message.includes(":")) {
                            const parts = message.split(":").map(Number);
                            if (parts.length === 3) totalSeconds = (parts[0] * 3600) + (parts[1] * 60) + parts[2];
                            else if (parts.length === 2) totalSeconds = (parts[0] * 60) + parts[1];
                        } else {
                            totalSeconds = parseInt(message);
                        }
                        
                        if (!isNaN(totalSeconds)) { 
                            Time = totalSeconds; 
                            updateDisplay(); 
                        }
                    }
                }
            };
            ComfyJS.Init("ixen_lol");
        } else {
            setTimeout(connectTwitch, 500);
        }
    }

    setInterval(TimeUp, 1000);
    connectTwitch();
</script>
</body>

</html>









